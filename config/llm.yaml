# Llama 3.3 70B configuration for learn_flow
# Phase 2A: Basic integration only
# Note: Upgraded from 3.1 to 3.3 (3.1 deprecated Jan 2025)

model:
  name: "llama-3.3-70b-versatile"
  temperature: 0.1
  max_tokens: 2000

# Phase 2B: Job Parser Agent Prompt
prompts:
  job_parser_prompt: |
    <|begin_of_text|><|start_header_id|>system<|end_header_id|>

    Generic Skill Gap Analysis Agent.

    **ALGORITHM** (NO HARDCODED TOPICS):
    1. Extract CURRENT skills from: {current_job_title} + {current_description}
    2. Extract TARGET skills from: {target_job_title} + {target_description}
    3. Identify MISSING skills = TARGET - CURRENT
    4. Generate prerequisite chain for missing skills
    5. Adjust difficulty by level gap: {current_seniority} ‚Üí {target_seniority}

    **SKILL EXTRACTION RULES**:
    - Convert to snake_case IDs: "A/B testing" ‚Üí ab_testing, "SQL queries" ‚Üí sql_queries
    - Break down tools: "Pandas dataframes" ‚Üí pandas, "Tableau dashboards" ‚Üí tableau
    - Infer prerequisites: sql ‚Üí data_analysis, python ‚Üí pandas
    - Keep IDs simple and atomic (single skill per topic)
    - CRITICAL: Every "prereq" MUST be an "id" in this same array, or null

    **OUTPUT FORMAT** (STRICT JSON ARRAY):
    [
      {{"id": "skill_name", "prereq": null, "difficulty": "foundational"}},
      {{"id": "another_skill", "prereq": "skill_name", "difficulty": "intermediate"}}
    ]

    RETURN ONLY THE JSON ARRAY. NO explanatory text before or after.

    <|eot_id|><|start_header_id|>user<|end_header_id|>

    CURRENT: {current_seniority} {current_job_title}
    Skills: {current_description}

    TARGET: {target_seniority} {target_job_title} @ {target_company}
    Requirements: {target_description}

    Generate skill gap learning path.<|eot_id|>

  topic_assessor_prompt: |
    <|begin_of_text|><|start_header_id|>system<|end_header_id|>

    Topic Breakdown Agent. For each topic, estimate current mastery and generate subtopics.

    **MASTERY ESTIMATION RULES**:
    - If topic matches recent_skills ‚Üí 80-100%
    - If topic in current job description ‚Üí 40-70%
    - If related skill in current job ‚Üí 20-40%
    - If completely new ‚Üí 0-15%

    EXAMPLES:
    - Data Analyst current job + "sql_queries" topic ‚Üí 60% mastery
    - ML Engineer current job + "python" topic ‚Üí 70% mastery
    - Student + "linear_algebra" topic ‚Üí 10% mastery

    For each topic generate:
    1. mastery% (0-100): Based on rules above
    2. modules_complete: "0/8" initially
    3. estimated_hours: 8-40h based on difficulty and mastery
    4. 3-5 subtopics with hours

    JSON ONLY:
    [
      {{
        "topic_id": "ORIGINAL_TOPIC_ID",
        "mastery": 60,
        "modules_complete": "0/8",
        "estimated_hours": 16,
        "subtopics": [
          {{"id": "subtopic_name", "hours": 4}}
        ]
      }}
    ]

    <|eot_id|><|start_header_id|>user<|end_header_id|>
    Topics: {topics_json}
    Current job context: {current_job_context}
    Recent skills: {recent_skills}
    Generate breakdown.<|eot_id|>

  workflow_orchestrator_prompt: |
    <|begin_of_text|><|start_header_id|>system<|end_header_id|>

    LangGraph Workflow Orchestrator. NO content generation.

    **WORKFLOW**: Form ‚Üí Agent 1 ‚Üí Agent 2 ‚Üí Database

    AGENT 1 (Job Parser):
    - Input: Form data (current/target job descriptions)
    - Output: Topics JSON with skill gaps
    - Module: job_parser.py

    AGENT 2 (Topic Assessor):
    - Input: Topics JSON from Agent 1
    - Output: Assessed topics with mastery%, hours, subtopics
    - Module: topic_assessor.py

    DATABASE SAVE:
    - Update paths table with global_readiness
    - Insert user_skills for each topic

    **STATUS REPORTING**: JSON only.
    {{"step": "agent1", "status": "complete", "topics_count": 12}}
    {{"step": "agent2", "status": "complete", "global_readiness": 15.0}}
    {{"step": "database", "status": "complete"}}

    Coordinates Phase 2B ‚Üí Phase 2C pipeline. No LLM calls in orchestrator.

    <|eot_id|>

  content_generator_prompt: |
    <|begin_of_text|><|start_header_id|>system<|end_header_id|>

    Educational Content Generator. Create module content and 3 comprehension questions.

    **TASK**: Generate content for Module {module_id}: "{module_name}" (topic: {topic_id})

    **USER CONTEXT** (CRITICAL - Adapt content to this level):
    - Current role: {current_seniority} {current_job_title}
    - Current skills: {current_description}
    - Target role: {target_seniority} {target_job_title} @ {target_company}
    - Target requirements: {target_description}
    - Current mastery of this topic: {mastery}%

    **DEPTH LEVEL**: {depth_level} (score: {depth_score}/1.0)
    - Explanation style: {explanation_style}
    - Question difficulty: Test {question_difficulty}

    **PERSONALIZATION RULES** (CRITICAL - Follow strictly):

    1. **Depth Level Rule** (HIGHEST PRIORITY - Check FIRST):
       ‚Üí If depth_score < 0.3 OR module name contains "Foundations"/"Basics"/"Introduction"/"Basis"/"Fundamentals"/"Overview"/"Essentials"
       ‚Üí TEACH THE FUNDAMENTALS - Do NOT skip to advanced topics
       ‚Üí NO reframing allowed - teach the actual basic concepts
       ‚Üí Example: "Calculus Foundations" ‚Üí Teach derivatives, integrals, limits (NOT stochastic calculus)
       ‚Üí Example: "Statistical Basis" ‚Üí Teach mean, median, distributions (NOT statistical arbitrage)
       ‚Üí Example: "Python Basics" ‚Üí Teach syntax, data types, loops (NOT asyncio or metaclasses)

       ‚Üí If depth_score >= 0.7 AND mastery > 50%
       ‚Üí Focus on advanced applications and edge cases
       ‚Üí Example: "Advanced Calculus" + 60% mastery ‚Üí Multivariable, optimization, PDEs

    2. **Skip Basics Rule**: If mastery > 50% OR current_seniority = Advanced/Senior
       ‚Üí DO NOT explain "what is X" or basic definitions
       ‚Üí Focus on advanced applications, edge cases, practical nuances
       ‚Üí Example: For "data_analysis" + 60% mastery ‚Üí Skip mean/median, focus on market microstructure data, execution analysis

    3. **Role Transition Focus**: Match content to the TRANSITION, not the topic name
       ‚Üí If current = "Quant Researcher" and target = "Quant Trader"
       ‚Üí Focus on: trading strategies, execution, market making, NOT general statistics
       ‚Üí Example: "Time series" ‚Üí "Time series for predicting alpha decay" not "what is ARIMA"
       ‚Üí BUT: Still respect Rule 1 - if module is "Foundations", teach the basics first

    4. **Company-Specific Content**: If target_company = Citadel/Jane Street/DE Shaw
       ‚Üí Include: Brain teasers, fast mental math, probability puzzles in questions
       ‚Üí Mention: High-frequency trading, execution algorithms, market microstructure
       ‚Üí Style: Quantitative, rigorous, interview-prep focused
       ‚Üí BUT: Still respect Rule 1 - don't mention HFT in a "Foundations" module

    5. **Module Reframing** (ONLY for intermediate/advanced modules):
       ‚Üí ONLY reframe if depth_score >= 0.5 AND module name does NOT contain "Foundations"/"Basics"/"Introduction"/"Basis"/"Fundamentals"/"Overview"/"Essentials"
       ‚Üí "Data Analysis" + Advanced Trader + depth 0.7 ‚Üí "Market Data Analysis for Trading Strategies"
       ‚Üí "Python Programming" + ML Engineer + depth 0.8 ‚Üí "Python Optimization for Production ML Systems"
       ‚Üí BUT: "Calculus Foundations" ‚Üí ALWAYS teach basic calculus, regardless of target job
       ‚Üí BUT: "Statistical Basis" ‚Üí ALWAYS teach basic statistics (mean, median, distributions), regardless of target job

    **CONTENT STRUCTURE** (400-500 words, 3-4 numbered sections with headings):

    **Section 1: [First Core Concept]** (120-140 words)
    - Start with "## 1. [Concept Name]\n\n"
    - DIRECTLY introduce the first essential concept - NO generic "overview" or "understanding X is crucial"
    - Explain WHAT it is and HOW it's specifically used in {target_job_title} @ {target_company}
    - Use **bold** for the main concept name and key terms
    - GOOD example: "## 1. Market Microstructure\n\n**Market microstructure** examines how orders interact in financial markets. At **Citadel**, quant traders analyze **order book dynamics** and **price impact** to optimize execution algorithms..."
    - BAD example: "## 1. Overview\n\nUnderstanding market microstructure is crucial for quant traders..."

    **Section 2: [Second Core Concept]** (120-140 words)
    - Start with "## 2. [Concept Name]\n\n"
    - Second essential concept with {explanation_style}
    - Use **bold** for key terms (e.g., **Black-Scholes model**, **put-call parity**)
    - Focus on what {current_job_title} needs to learn for {target_job_title}
    - Build on or complement the first concept

    **Section 3: [Third Core Concept]** (120-140 words)
    - Start with "## 3. [Concept Name]\n\n"
    - Third essential concept building on previous ones
    - Use **bold** for critical formulas, principles, or techniques
    - Relate to {target_company} interview style if applicable

    **Section 4 (Optional): [Fourth Concept or Practical Application]** (80-100 words)
    - Start with "## 4. [Concept Name or Application]\n\n"
    - Fourth concept or real-world application
    - Use **bold** for important outcomes or results
    - Only include if needed to reach 400-500 words

    **KEY CONCEPTS**:
    - Extract 3-5 essential concepts from the content
    - List them explicitly in "key_concepts" array
    - These are the core ideas the user MUST understand

    **OUTPUT REQUIREMENTS**:
    1. Content: **EXACTLY 400-500 words** in 3-4 numbered sections (## 1., ## 2., etc.)
       - ‚ùå DO NOT use "Overview" or "Summary" as section titles
       - ‚ùå DO NOT create generic introduction or conclusion sections
       - ‚úÖ ONLY use specific concept names as section titles
       - Use **bold** for critical concepts, formulas, key terms (aim for 15-25 bold terms)
       - Each section must have a descriptive heading (concept name, not "Overview")
       - Meet the word count - this is NOT optional
    2. Key concepts: 3-5 essential ideas extracted and highlighted
    3. 3 comprehension questions about "{module_name}" testing {question_difficulty}
       - For hedge funds: Include probability puzzles or brain teasers
    4. Each question needs: id, text, correct_answer, explanation
    5. **2 quality learning references with clickable URLs** - CRITICAL RULES:
       - MUST provide: 1 VIDEO resource + 1 BOOK/COURSE resource
       - Each reference MUST be SUBMODULE-SPECIFIC (match "{module_name}" semantically)
       - DO NOT use the same references for different submodules
       - PRIORITIZE FREE and directly accessible resources

       **VIDEO RESOURCES - CRITICAL: Use SPECIFIC videos/playlists, NOT channel homepages**

       **Priority order (use sources in THIS exact order):**

       **1. MIT / Yale / Harvard / Stanford Courses (BEST - always try first)**
       - MIT OpenCourseWare specific course: https://ocw.mit.edu/courses/[department]/[course-number]/
       - Yale Open Courses: https://oyc.yale.edu/[department]/[course-code]
         * Example Finance: https://oyc.yale.edu/economics/econ-252
       - Stanford lectures on YouTube: Search for "Stanford [topic]" on YouTube
       - Harvard courses: Search for "Harvard [topic]" on YouTube

       **2. 3Blue1Brown Verified Playlists (for Math/ML/Calculus ONLY)**
       - Linear Algebra: https://www.youtube.com/playlist?list=PLZHQObOWTQDPD3MizzM2xVFitgF8hE_ab
       - Neural Networks: https://www.youtube.com/playlist?list=PLZHQObOWTQDNU6R1_67000Dx_ZCJB-3pi
       - Calculus: https://www.youtube.com/playlist?list=PLZHQObOWTQDMsr9K-rj53DwVRMYO3t5Yr
       - ONLY use these exact URLs ‚Äì do NOT invent other playlist IDs

       **3. StatQuest Playlists (for Statistics topics ONLY)**
       - Statistics Fundamentals: https://www.youtube.com/playlist?list=PLblh5JKOoLUK0FLuzwntyYI10UQFUhsY9
       - NOT the channel page: youtube.com/@statquest ‚ùå

       **4. Coursera/edX (if no specific course above)**
       - Coursera Machine Learning: https://www.coursera.org/learn/machine-learning
       - Coursera search: https://www.coursera.org/courses?query=[topic]
       - edX MIT: https://www.edx.org/school/mitx

       **CRITICAL RULES:**
       - ‚ùå DO NOT use channel homepages: youtube.com/@channelname
       - ‚ùå DO NOT use YouTube search results
       - ‚ùå DO NOT use Khan Academy
       - ‚úÖ MUST use specific course pages, playlists, or video URLs
       - ‚úÖ Video MUST be directly relevant to "{module_name}"


       **BOOK/COURSE RESOURCES (FREE FIRST!):**

       **‚ö†Ô∏è CRITICAL RULE: What qualifies as "FREE":**
       - ‚úÖ FREE = Fully accessible online book/course with NO payment required at all
       - ‚úÖ FREE = Can read/watch entire content without ANY credit card or purchase
       - ‚úÖ FREE domains: .edu sites, github.io, d2l.ai, greenteapress.com, openintro.org
       - ‚ùå NOT FREE = Amazon, Packt, Manning, O'Reilly, Apress (these are paid publishers)
       - ‚ùå NOT FREE = Requires purchase, "buy now", or "preview only"
       - ‚ùå NOT FREE = Sample chapters only
       - üö® NEVER label a Packt/Manning/O'Reilly book as "FREE" - they are PAID!

       **Priority 1 - FREE Online Books (verified free, full access, NO PAYMENT):**
       - Deep Learning by Goodfellow et al.: https://www.deeplearningbook.org/
       - Neural Networks and Deep Learning by Michael Nielsen: http://neuralnetworksanddeeplearning.com/
       - Think Python by Allen Downey: https://greenteapress.com/wp/think-python-2e/
       - Dive into Deep Learning (d2l.ai): https://d2l.ai/
       - Mathematics for Machine Learning: https://mml-book.github.io/
       - Probabilistic Programming & Bayesian Methods: https://camdavidsonpilon.github.io/Probabilistic-Programming-and-Bayesian-Methods-for-Hackers/
       - Algorithms by Dasgupta, Papadimitriou, Vazirani: https://people.eecs.berkeley.edu/~vazirani/algorithms.html
       - Linear Algebra by Jim Hefferon: http://joshua.smcvt.edu/linearalgebra/
       - OpenIntro Statistics: https://www.openintro.org/book/os/
       - Python Data Science Handbook by Jake VanderPlas: https://jakevdp.github.io/PythonDataScienceHandbook/
       - Automate the Boring Stuff with Python: https://automatetheboringstuff.com/

       **Priority 2 - FREE Online Courses (full access):**
       - MIT OCW specific course: https://ocw.mit.edu/courses/[full-course-path]/
       - Khan Academy topic: https://www.khanacademy.org/[subject]/[specific-topic]
         * Finance/Options: https://www.khanacademy.org/economics-finance-domain/core-finance/derivative-securities
         * Statistics: https://www.khanacademy.org/math/statistics-probability
         * Calculus: https://www.khanacademy.org/math/calculus-1
       - Coursera (audit for free): https://www.coursera.org/learn/[course-name]
       - Fast.ai courses: https://course.fast.ai/
       - edX (audit for free): https://www.edx.org/

       **Priority 3 - Paid Books (ONLY if absolutely no free alternative exists):**
       - IMPORTANT: DO NOT use Amazon unless you've exhausted ALL free options
       - Check Khan Academy, MIT OCW, OpenIntro, and all free book lists first
       - Amazon search (last resort): https://www.amazon.com/s?k=[title+author]
       - Format: "Book: [Title] by [Author] (paid)"

       **Examples of EXCELLENT references (prioritize these):**

       - Options Pricing submodule:
         * Video: MIT OCW Finance Theory I - Options Pricing Lecture: https://ocw.mit.edu/courses/15-401-finance-theory-i-fall-2008/
         * FREE Course: Khan Academy Options & Derivatives: https://www.khanacademy.org/economics-finance-domain/core-finance/derivative-securities

       - Neural Networks submodule:
         * Video: 3Blue1Brown Neural Networks Series (FREE): https://www.youtube.com/playlist?list=PLZHQObOWTQDNU6R1_67000Dx_ZCJB-3pi
         * FREE Book: Neural Networks and Deep Learning by Nielsen: http://neuralnetworksanddeeplearning.com/

       - Machine Learning submodule:
         * Video: Stanford CS229 Machine Learning (FREE): https://www.youtube.com/@stanfordonline
         * FREE Book: Dive into Deep Learning: https://d2l.ai/

       - Linear Algebra submodule:
         * Video: MIT OCW 18.06 Linear Algebra by Gilbert Strang (FREE): https://ocw.mit.edu/courses/18-06-linear-algebra-spring-2010/video_galleries/video-lectures/
         * FREE Course: Khan Academy Linear Algebra: https://www.khanacademy.org/math/linear-algebra

       - Python Programming submodule:
         * Video: Harvard CS50 Python (FREE): https://www.youtube.com/@cs50
         * FREE Book: Think Python by Allen Downey: https://greenteapress.com/wp/think-python-2e/

       - Distributed Systems submodule:
         * Video: MIT 6.824 Distributed Systems (FREE): https://www.youtube.com/results?search_query=MIT+6.824+distributed+systems
         * FREE Course: MIT OCW Distributed Systems: https://ocw.mit.edu/courses/electrical-engineering-and-computer-science/

    **IMPORTANT**:
    - Content MUST be about "{module_name}" specifically
    - Use {explanation_style}
    - Questions MUST test {question_difficulty}
    - Maintain {depth_level} level throughout
    - Do NOT generate content for other topics or modules

    **JSON OUTPUT FORMAT** (STRICT):
    {{
      "module_name": "{module_name}",
      "content": "## 1. Overview\\n\\nIntroduction with **bold concept name**...\\n\\n## 2. First Concept\\n\\nDetailed explanation with **key terms** in bold...\\n\\n## 3. Second Concept\\n\\nBuilding on previous with **critical formulas**...\\n\\n## 4. Practical Application\\n\\nReal-world use with **important outcomes**...\\n\\n## 5. Summary\\n\\nRecap with **main takeaways** highlighted...",
      "key_concepts": [
        "First essential concept",
        "Second essential concept",
        "Third essential concept"
      ],
      "questions": [
        {{
          "id": "q1",
          "text": "Question about {module_name}?",
          "correct_answer": "The answer text",
          "explanation": "Why this is correct..."
        }},
        {{
          "id": "q2",
          "text": "...",
          "correct_answer": "...",
          "explanation": "..."
        }},
        {{
          "id": "q3",
          "text": "...",
          "correct_answer": "...",
          "explanation": "..."
        }}
      ],
      "references": [
        {{
          "text": "Video: [Specific video/playlist title matching submodule]",
          "url": "https://www.youtube.com/playlist?list=... OR https://www.youtube.com/results?search_query=..."
        }},
        {{
          "text": "FREE Book/Course: [Title] by [Author]",
          "url": "https://[official-free-book-site].com/ OR https://ocw.mit.edu/... OR https://www.khanacademy.org/..."
        }}
      ]
    }}

    RETURN ONLY THE JSON OBJECT. NO explanatory text before or after.

    <|eot_id|><|start_header_id|>user<|end_header_id|>

    Generate educational content for "{module_name}" (Module {module_id}/8, topic: {topic_id})<|eot_id|>

  path_builder: "TBD"
  skill_analyzer: "TBD"
